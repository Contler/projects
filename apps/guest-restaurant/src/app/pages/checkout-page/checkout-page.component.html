<ctr-navbar></ctr-navbar>
<div class="px-4 py-5">
  <div class="mb-3">
    <p class="text-xl font-semibold">
      {{ 'product.confirmOrder' | translate }}
    </p>
  </div>
  <p class="text-base font-semibold">
    {{ 'checkout.products' | translate }}
  </p>

  <div class="border rounded-xl p-2">
    @for (cartItemByRestaurant of cartItemsByRestaurant; track cartItemByRestaurant.restaurant.uid) {
      <div
        class="flex justify-between items-center border-b pb-4 pt-2 px-1"
        mat-ripple
        (click)="expandRestaurant(cartItemByRestaurant.restaurant.uid)"
      >
        <div class="flex gap-x-2 items-center">
          <img class="h-8 w-8 object-cover rounded-[100%]" [src]="cartItemByRestaurant.restaurant.image" alt="" />
          <p class="text-sm font-semibold">
            {{ cartItemByRestaurant.restaurant.name | dynamicTranslate | async }}
          </p>
        </div>
        <div class="flex gap-x-2 items-center">
          <p class="text-sm font-semibold">{{ cartItemByRestaurant.items.length }} Products</p>
          @if (isRestaurantExpanded(cartItemByRestaurant.restaurant.uid)) {
            <mat-icon> expand_less </mat-icon>
          } @else {
            <mat-icon> expand_more </mat-icon>
          }
        </div>
      </div>

      @if (isRestaurantExpanded(cartItemByRestaurant?.restaurant?.uid || '')) {
        @for (order of cartItemByRestaurant.items; track order.id) {
          <div class="border-b border-neutral-200 py-2 px-1">
            <div class="flex gap-x-5">
              <img [src]="order.product.image" class="w-[50px] h-[50px] rounded-xl object-cover" alt="" />
              <div>
                <p class="text-sm font-semibold">
                  {{ order.product.name | dynamicTranslate | async }}
                </p>
                <p class="text-sm font-semibold text-neutral-300">
                  {{ order.product.description | dynamicTranslate | async }}
                </p>

                <p class="text-sm font-semibold text-neutral-600 flex gap-x-2">
                  {{ order.product.value * order.quantity | currency: symbol ?? '' }}
                </p>
              </div>
            </div>
            <div class="flex justify-end">
              <div class="flex gap-x-2">
                @if (order.quantity > 1) {
                  <mat-icon> remove </mat-icon>
                } @else {
                  <mat-icon> delete </mat-icon>
                }

                <p>
                  {{ order.quantity }}
                </p>

                <mat-icon> add </mat-icon>
              </div>
            </div>
          </div>
        }
      }
    }

    <div class="py-2">
      <div class="flex justify-between text-sm font-semibold">
        <p>
          {{ 'checkout.productCost' | translate }}
        </p>
        <p>
          {{ total | currency: symbol ?? '' }}
        </p>
      </div>
      @if (roomService?.cost) {
        <div class="flex justify-between text-sm font-semibold mt-2">
          <p>
            {{ 'checkout.shippingCost' | translate }}
          </p>
          <p>
            {{ roomService?.cost | currency: symbol ?? '' }}
          </p>
        </div>
      }

      <div class="flex justify-between text-sm font-semibold mt-2">
        <p>
          {{ 'checkout.total' | translate }}
        </p>
        <p>
          {{ total + (roomService?.cost || 0) | currency: symbol ?? '' }}
        </p>
      </div>
    </div>
  </div>

  <div class="mt-5">
    <p class="font-semibold">
      {{ 'checkout.placeDelivery' | translate }}
    </p>
    <div class="mt-2">
      <ctr-box-field [label]="'room' | translate" (action)="openZoneBottomSheet()">
        <ng-container icon>location_on</ng-container>
      </ctr-box-field>
    </div>
  </div>

  <div class="mt-5">
    <p class="font-semibold">
      {{ 'checkout.timeDelivery' | translate }}
    </p>
    <div class="mt-2">
      <ctr-box-field
        (action)="openTimeBottomSheet()"
        [label]="'checkout.asap' | translate"
        [description]="
          ('checkout.timeDescription' | translate) +
          ' ' +
          (roomService?.estimatedTime || '60') +
          ' ' +
          ('checkout.minutes' | translate)
        "
      >
        <ng-container icon>schedule</ng-container>
      </ctr-box-field>
    </div>
  </div>

  <div class="mt-5">
    <ctr-box-field
      [label]="'checkout.payment' | translate"
      [description]="paymentMethod | translate"
      (action)="openPaymentBottomSheet()"
    >
      <ng-container icon>schedule</ng-container>
    </ctr-box-field>
  </div>
</div>
